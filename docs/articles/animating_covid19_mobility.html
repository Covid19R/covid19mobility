<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Animating Covid-19 Mobility Data • covid19mobility</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Animating Covid-19 Mobility Data">
<meta property="og:description" content="covid19mobility">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covid19mobility</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/animating_covid19_mobility.html">Animating Covid-19 Mobility Data</a>
    </li>
    <li>
      <a href="../articles/apple_cities_across_space_and_change.html">How mobility has changed in cities around the world</a>
    </li>
    <li>
      <a href="../articles/google_work_v_play.html">Work versus Home in the Google Mobility Data</a>
    </li>
    <li>
      <a href="../articles/plot_us_mobility.html">What are mobility trends like in the US?</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Covid19R/covid19mobility/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Animating Covid-19 Mobility Data</h1>
                        <h4 class="author">Cleo Falvey</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Covid19R/covid19mobility/blob/master/vignettes/animating_covid19_mobility.Rmd"><code>vignettes/animating_covid19_mobility.Rmd</code></a></small>
      <div class="hidden name"><code>animating_covid19_mobility.Rmd</code></div>

    </div>

    
    
<p>Hello everyone! This vignette shows how to plot social distancing data on a map using the <a href="https://github.com/Covid19R/covid19mobility/">covid19mobility package</a>.</p>
<p>The packages used to perform the analyses are below, in the approximate order they were used, and what they were used for.</p>
<p>First, we call the data from Apple using the <code><a href="../reference/refresh_covid19mobility_apple_subregion.html">refresh_covid19mobility_apple_subregion()</a></code> function. There are multiple data sets in the covid19mobility package, so you could theoretically put in any of the other functions to look at different regions and breakdowns of data. I recommend running the <code>refresh</code> functions by one so you can see what the data structure looks like before you start tidying. Here is what the raw data looks like below. We can see that this data is global and breaks down the type of movement (driving, transit, walking) and also includes location codes and types.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/refresh_covid19mobility_apple_subregion.html">refresh_covid19mobility_apple_subregion</a></span>())
<span class="co">#&gt; # A tibble: 6 x 9</span>
<span class="co">#&gt;   date       location location_type location_code location_code_t… data_type</span>
<span class="co">#&gt;   &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;         &lt;chr&gt;            &lt;chr&gt;    </span>
<span class="co">#&gt; 1 2020-01-13 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; 2 2020-01-14 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; 3 2020-01-15 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; 4 2020-01-16 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; 5 2020-01-17 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; 6 2020-01-18 Abruzzo… state         IT-65         iso_3166_2       driving_…</span>
<span class="co">#&gt; # … with 3 more variables: value &lt;dbl&gt;, alternative_name &lt;chr&gt;, country &lt;chr&gt;</span></pre></body></html></div>
<p>What we are then going to do is tidy up that above data using <code>dplyr</code> verbs (my favorite!) First, we want to select all of the datapoints from the US. We’re going to summarize and group each state by mean by date. We also want to only graph weekly intervals to limit the amount of frames in the gif: If you try to put them all in the same gif at once it looks like a nightmare.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">apple_us</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/refresh_covid19mobility_apple_subregion.html">refresh_covid19mobility_apple_subregion</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">country</span><span class="kw">==</span><span class="st">"United States"</span>) <span class="kw">%&gt;%</span> <span class="co"># we are only going to map the US</span>
  <span class="fu">group_by</span>(<span class="no">location</span>,<span class="no">date</span>) <span class="kw">%&gt;%</span> <span class="co">#we are going to group by location (which is the state) and date</span>
  <span class="fu">summarize_if</span>(<span class="no">is.numeric</span>, <span class="no">mean</span>) <span class="kw">%&gt;%</span> <span class="co">#we are going to take the mean mobility score across counties by date and state</span>
  <span class="fu">mutate</span>(<span class="kw">weeks</span><span class="kw">=</span><span class="fu">round_date</span>(<span class="no">date</span>, <span class="st">"weeks"</span>)) <span class="kw">%&gt;%</span> <span class="co">#we are going to take only the first date of each week</span>
  <span class="fu">group_by</span>(<span class="no">weeks</span>) <span class="kw">%&gt;%</span> <span class="co"># we are going to group by each week</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="no">date</span><span class="kw">==</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">weeks</span>)) <span class="co">#again we want to take only the first date of each week</span></pre></body></html></div>
<p>The next thing we are going to do is we’re going to call shape files for the US states and counties. We get this from the <a href="https://github.com/UrbanInstitute/urbnmapr">urbnmapr</a> package. We need to also call the <a href="https://cran.r-project.org/web/packages/sf/index.html">sf package</a> because we are working with shapefiles.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">states_sf</span> <span class="kw">&lt;-</span> <span class="kw pkg">urbnmapr</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/urbnmapr/man/get_urbn_map.html">get_urbn_map</a></span>(<span class="st">"states"</span>, <span class="kw">sf</span><span class="kw">=</span><span class="fl">TRUE</span>) <span class="kw">%&gt;%</span>
  <span class="fu">st_as_sf</span>() <span class="co"># coerce this to a shapefile.</span></pre></body></html></div>
<p>Here, we want to <code>left_join()</code> our shapefile tibble and our mobility tibble together so that we can graph them all together. Sometimes ggplot will throw an error because when you join the tibbles, you lose the identification that we do have shapefiles in our data set (see <a href="https://github.com/tidyverse/ggplot2/issues/3391">this github post</a>. So you always want to use <code>st_as_sf()</code> to save the day!)</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">total_apple_us</span>  <span class="kw">&lt;-</span> <span class="fu">left_join</span>(<span class="no">apple_us</span>,<span class="no">states_sf</span>, <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"location"</span><span class="kw">=</span><span class="st">"state_name"</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">st_as_sf</span>() <span class="co"># this function makes sure the shape files are readable.</span>

<span class="no">total_apple_us</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="no">total_apple_us</span>) <span class="kw">%&gt;%</span>
  <span class="fu">st_as_sf</span>()</pre></body></html></div>
<p>Now, we are going to set up our ggplot graph. First, we need to check and make sure that the state shapefile data is good, so we graph it below.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">ggplot</span>() +
  <span class="fu">geom_sf</span>(<span class="kw">data</span><span class="kw">=</span><span class="no">states_sf</span>)</pre></body></html></div>
<p><img src="animating_covid19_mobility_files/figure-html/unnamed-chunk-9-1.png" width="100%"></p>
<p>Finally, we can construct the graph. There are a lot of moving parts here, so I’ve commented each line to indicate what it does.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">ggplot</span>() + <span class="co">#call ggplot</span>
  <span class="fu">geom_sf</span>(<span class="kw">data</span><span class="kw">=</span><span class="no">states_sf</span>) + <span class="co"># map the shape files to the map of the USA</span>
  <span class="fu">geom_sf</span>(<span class="kw">data</span><span class="kw">=</span> <span class="no">total_apple_us</span>, <span class="fu">aes</span>(<span class="kw">fill</span><span class="kw">=</span><span class="no">value</span>)) + <span class="co"># fill with our data frame and value, which is mobility score</span>
  <span class="fu">labs</span>(<span class="kw">fill</span><span class="kw">=</span><span class="st">"% change in mobility"</span>,
       <span class="kw">title</span><span class="kw">=</span><span class="st">"Date: {current_frame}"</span>,
       <span class="kw">subtitle</span><span class="kw">=</span><span class="st">"Percent Change in Movement, Source: Apple Mobility Data"</span>,
       <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"% change in mobility"</span>) + <span class="co">#add titles</span>
  <span class="fu">scale_fill_viridis_c</span>() +
  <span class="fu">transition_manual</span>(<span class="no">date</span>) <span class="co">#animate by day - this is a gganimate function!</span>
<span class="co">#&gt; nframes and fps adjusted to match transition</span></pre></body></html></div>
<p><img src="animating_covid19_mobility_files/figure-html/unnamed-chunk-10-1.gif" width="100%"></p>
<p>In the graph, darker colors indicate less movement than usual (compared to the baseline) and lighter colors indicate more movement. When you look at this graph, it’s pretty cool to notice how the percent change in mobility decreases as the pandemic progresses and social distancing continues on. However, you can also see that towards the end of the gif, some of the states start moving around more as reopenings begin.</p>
<p>And that’s pretty much it! You can apply this method of graphing to multiple segments of the data and functions in the package, including the Apple data, the Google data, and you can also use ggmap to make worldwide maps. Happy mapping, and stay safe out there!</p>
<p>Cleo Falvey</p>
<p>UMass Boston Biology Major, Math Minor</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jarrett Byrnes.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
